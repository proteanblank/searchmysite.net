{% extends "layoutwithsearchbox.html" %}

{% block title %}Search My Site - {{ subtitle }}{% endblock %}

{% block head %}<link rel="stylesheet" type="text/css" href="/static/css/letterpress.css"/>{% endblock %}

{% block content %}

			<form method="POST" class="sms-results-form">

				<script>
					function refreshPage(formName) {
						formName.submit();
					}
				</script>

				{% if (no_of_results and no_of_results > 0) or (no_of_domains and no_of_domains > 0) %}

				<div class="row mt-2">
					<!-- <div class="col-sm-2 col-md-4 sms-filters">
						<a class="btn btn-primary" data-bs-toggle="offcanvas" href="#offcanvas" role="button" aria-controls="offcanvas">
						Filters
						</a>
					</div> -->
					<div class="col-sm-2 col-md-4 text-center sms-feed">
						{% if no_of_results %}
						{{ no_of_results }} results
						{% elif no_of_domains %}
						{{ no_of_domains }} sites
						{% endif %}
						{% if links and 'full_feed_link' in links %}
						<a class="btn align-baseline" href="{{ links['full_feed_link'] }}"><img src="/static/images/rss.svg" alt="Feed" width="18" height="18"></a>
						{% endif %}
					</div>
					<div class="col-sm-8 col-md-4">
						<div class="input-group">
							<label class="input-group-text" for="sort">Sort by</label>
							<select class="form-select" id="sort" name="sort" onchange="refreshPage(this.form);">
								{% for value in sort_options.keys() %}
								<option value="{{value}}"{% if value == params['sort'] %} selected{% endif %}>{{sort_options[value]}}</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>

				{% if display_type == 'list' %}
				<div class="row">
					<div class="col-lg-12">
						{% for result in results %}
						<div class="search-result">
							<p>
								<h5 class="fw-normal">
									{% if result['contains_adverts'] %}<img src="/static/images/containsadverts44x24.gif" alt="Page contains adverts" class="float-left" style="margin-right: 4px">{% endif %}
									{% if result['published_date'] %}<span id="result-published-date">{{ result['published_date'] }}</span>:{% endif %}
									<a href="{{ result['url'] }}" class="result-title">{{ result['short_title'] }}</a>
								</h5>
							<a href="{{ result['url'] }}" class="result-link">{{ result['url'] }}</a>
							{% if result['highlight'] %}
								<span id="result-hightlight">
									<br>{{ result['highlight'][0] }}
									{% if result['highlight'][2] %}
									<b>{{ result['highlight'][1] }}</b>{{ result['highlight'][2] }}
									{% endif %}
									{% if result['highlight'][4] %}
									<b>{{ result['highlight'][3] }}</b>{{ result['highlight'][4] }}
									{% endif %}
								</span>
							{% endif %}
							{% if result['subresults'] %}
								<small>
									{% for subresult in result['subresults'] %}
									<br><a href="{{ subresult['url'] }}" class="result-title">{{ subresult['short_title'] }}</a>
									{% endfor %}
									<br><a href="?{{ result['subresults_link'] }}" class="result-title">{{ result['subresults_link_text'] }}</a>
								</small>
							{% endif %}
							</p>
						</div>
						{% endfor %}
					</div>
				</div>
				{% endif %}
				{% if display_type == 'table' %}
				<div class="row">
					<div class="col-12">
						<table class="table table-striped table-bordered table-sm">
							<thead>
								<tr>
									<th scope="col">Site</th>
									<th scope="col" class="d-none d-sm-table-cell">Domain</th>
									<th scope="col" class="d-none d-sm-table-cell">Tags</th>
									<th scope="col" class="d-none d-sm-table-cell">Feed</th>
								</tr>
							</thead>
							<tbody>
							{% for result in results %}
							<tr class="search-result">
								<td>
									<a href="{{ result['url'] }}" class="result-title" title="{{ result['full_title'] }}">{{ result['short_title'] }}</a>
									<span class="d-block d-sm-none"><a href="/search/?q=domain:{{ result['domain'] }}" class="result-link">{{ result['domain'] }}</a>
									{% if result['web_feed'] %}
									<span class="float-end"><a href="{{ result['web_feed'] }}" class="result-link"><img src="/static/images/rss.svg" alt="Feed" width="18" height="18"></a></span>
									{% endif %}
									</span>
								</td>
								<td class="d-none d-sm-table-cell"><a href="/search/?q=domain:{{ result['domain'] }}" class="result-link">{{ result['domain'] }}</a></td>
								<td class="d-none d-sm-table-cell">
									{% for tag in result['tags'] %}
										<a href="/search/?q=tags%3A%22{{ tag | urlencode }}%22" class="badge bg-primary">{{ tag }}</a>
									{% endfor %}
									{% if result['tags_truncated'] == True %}
										...
									{% endif %}
								</td>
								<td class="d-none d-sm-table-cell">
									{% if result['web_feed'] %}
										<a href="{{ result['web_feed'] }}" class="result-link"><img src="/static/images/rss.svg" alt="Feed" width="18" height="18"></a>
									{% endif %}
								</td>
							</tr>
							{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
				{% endif %}

				<!-- <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvas" aria-labelledby="offcanvasLabel">
					<div class="offcanvas-header">
						<h5 class="offcanvas-title" id="offcanvasLabel">Filters</h5>
						<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
					</div>
					<div class="offcanvas-body">
						{% for facet in facets %}
							{% if facet['inputs'] %}
								{{ facet['label_name'] }}<br>
								{% for input in facet['inputs'] %}
								<div class="form-check">
									<input class="form-check-input" type="{{ input['type'] }}" name="{{ input['name'] }}" value="{{ input['value'] }}" id="{{ input['id'] }}" onchange="refreshPage(this.form);" {{ input['state'] }}>
									<label class="form-check-label" for="{{ input['id'] }}">{{ input['label'] }}</label>
								</div>
								{% endfor %}
							{% endif %}
						{% endfor %}
					</div>
				</div> -->

				<nav aria-label="Page navigation">
					<ul class="pagination pg-blue justify-content-center">
					{% for page in pagination %}
						{% if pagination[page] %}
							<button type="submit" name="page" value="{{ page }}" class="page-item page-link">{{ page }}</button>
						{% else %}
							<li class="page-item active"><a class="page-link">{{ page }}</a></li>
						{% endif %}
					{% endfor %}
					</ul>
				</nav>

				{% else %}

				<div class="row">
					<div class="col-lg-12">
						<p>No results found for <em>{{ params['q'] }}</em>.</p>
					</div>
				</div>

				{% endif %}

			</form>
{% endblock %}
